<!-- FIXME Remove check for whether isFulfilled exists -->
<!-- FIXME Remove check for getAnnotation -->
<!-- TODO This seems slightly janky -->
<!-- FIXME This can also be an XSS vector -->
<ng-template #annotation>
  <div [outerHTML]="getAnnotation()"></div>
</ng-template>

<ng-template #standardReq>{{ requirement.name }}<span *ngIf="getAnnotation()"> *</span></ng-template>
<ng-template #tagReq>
  <div (click)="openRequirementDisplay(requirementDisplayTemplate)">
    {{ requirement.name }}<span *ngIf="getAnnotation()"> *</span>
  </div>
</ng-template>
<ng-template #multiReqOne>
  One of
  <app-requirement
    *ngFor="let childReq of getMulti().requirements"
    [requirement]="childReq"
    [courses]="courses"
  ></app-requirement>
</ng-template>
<ng-template #multiReqSome>
  {{ getMulti().numFulfilled(courses) }}/{{ getMulti().numRequired }} of
  <app-requirement
    *ngFor="let childReq of getMulti().requirements"
    [requirement]="childReq"
    [courses]="courses"
  ></app-requirement>
</ng-template>
<ng-template #multiReqAll>
  All of
  <app-requirement
    *ngFor="let childReq of getMulti().requirements"
    [requirement]="childReq"
    [courses]="courses"
  ></app-requirement>
</ng-template>
<ng-template #unitReq>
  <div (click)="openRequirementDisplay(unitDisplayTemplate)">
    {{ getUnit().unitsFulfilled(courses) }}/{{ getUnit().units }} units of
    <br />
    {{ getUnit().requirement.toString() }}
    <table class="courses">
      <tr *ngFor="let course of getUnit().getFulfillingCourses(courses)">
        <td>{{ course.getName() }}</td>
      </tr>
    </table>
  </div>
  <ng-template #unitDisplayTemplate>
    <app-requirement-display [requirementInput]="getUnit().requirement"></app-requirement-display>
  </ng-template>
</ng-template>
<ng-template #mutexReq>
  Distinctly fulfill
  <div class="nested">
    <div *ngFor="let childStatus of getMutex().getFulfillment(courses)" [ngClass]="getMutexFulfillment(childStatus)">
      <div (click)="openRequirementDisplay(mutexDisplayTemplate)">
        {{ childStatus.requirement.name }}
      </div>
      <ng-template #mutexDisplayTemplate>
        <app-requirement-display [requirementInput]="childStatus.requirement"></app-requirement-display>
      </ng-template>
    </div>
  </div>
</ng-template>

<div
  class="requirement"
  [ngClass]="requirement.isFulfilled && requirement.isFulfilled(courses) ? 'fulfilled' : 'unfulfilled'"
  [ngbPopover]="requirement.getAnnotation && requirement.getAnnotation() ? annotation : null"
  triggers="mouseenter:mouseleave"
>
  <ng-container *ngTemplateOutlet="getReqTemplate()"></ng-container>
</div>

<ng-template #requirementDisplayTemplate>
  <app-requirement-display [requirementInput]="requirement"></app-requirement-display>
</ng-template>
