<!-- TODO This seems slightly janky -->
<!-- FIXME This can also be an XSS vector -->
<ng-template #annotation>
  <div [outerHTML]="getAnnotation()"></div>
</ng-template>

<ng-template #standardReq>{{ requirement.name }}<span *ngIf="getAnnotation()"> *</span></ng-template>

<ng-template #tagReq>
  {{ requirement.name }}<span *ngIf="getAnnotation()"> *</span>
  <div ngbDropdownclass="req-more">
    <button ngbDropdownToggle></button>
    <div ngbDropdownMenu>
      <button (click)="openRequirementDisplay(requirementDisplayTemplate)">Show Fulfilling Courses</button>
    </div>
  </div>
</ng-template>

<ng-template #multiReqOne>
  One of
  <app-requirement
    *ngFor="let childReq of getMulti().requirements"
    [requirement]="childReq"
    [courses]="courses"
  ></app-requirement>
</ng-template>

<ng-template #multiReqSome>
  {{ getMulti().numFulfilled(courses) }}/{{ getMulti().numRequired }} of
  <app-requirement
    *ngFor="let childReq of getMulti().requirements"
    [requirement]="childReq"
    [courses]="courses"
  ></app-requirement>
</ng-template>

<ng-template #multiReqAll>
  All of
  <app-requirement
    *ngFor="let childReq of getMulti().requirements"
    [requirement]="childReq"
    [courses]="courses"
  ></app-requirement>
</ng-template>

<ng-template #unitReq>
  {{ getUnit().unitsFulfilled(courses) }}/{{ getUnit().units }} units of
  <br />
  {{ getUnit().requirement.toString() }}
  <div ngbDropdownclass="req-more">
    <button ngbDropdownToggle></button>
    <div ngbDropdownMenu>
      <button (click)="openRequirementDisplay(unitDisplayTemplate)">Show Fulfilling Courses</button>
    </div>
  </div>
  <div class="nested">
    <div class="course" *ngFor="let course of getUnit().getFulfillingCourses(courses)">
      {{ course.getName() }}
    </div>
  </div>
  <ng-template #unitDisplayTemplate>
    <app-requirement-display [requirementInput]="getUnit().requirement"></app-requirement-display>
  </ng-template>
</ng-template>

<ng-template #mutexReq>
  Distinctly fulfill
  <div class="nested">
    <div *ngFor="let childStatus of getMutex().getFulfillment(courses)" [ngClass]="getMutexFulfillment(childStatus)">
      {{ childStatus.requirement.name }}
      <div ngbDropdownclass="req-more">
        <button ngbDropdownToggle></button>
        <div ngbDropdownMenu>
          <button (click)="openRequirementDisplay(mutexDisplayTemplate)">Show Fulfilling Courses</button>
        </div>
      </div>
      <ng-template #mutexDisplayTemplate>
        <app-requirement-display [requirementInput]="childStatus.requirement"></app-requirement-display>
      </ng-template>
    </div>
  </div>
</ng-template>

<div
  class="requirement"
  [ngClass]="requirement.isFulfilled(courses) ? 'fulfilled' : 'unfulfilled'"
  [ngbPopover]="requirement.getAnnotation() ? annotation : null"
  triggers="mouseenter:mouseleave"
>
  <ng-container *ngTemplateOutlet="getReqTemplate()"></ng-container>
</div>

<ng-template #requirementDisplayTemplate>
  <app-requirement-display [requirementInput]="requirement"></app-requirement-display>
</ng-template>
