<!-- TODO This seems slightly janky -->

<ng-template #standardReq>{{ requirement.name }}<span *ngIf="getAnnotation()"> *</span></ng-template>

<ng-template #tagReq>
  {{ requirement.name }}<span *ngIf="getAnnotation()"> *</span>
  <div ngbDropdown class="req-more">
    <button ngbDropdownToggle></button>
    <div ngbDropdownMenu>
      <button ngbDropdownItem (click)="openRequirementDisplay(requirement)">
        Show Fulfilling Courses
      </button>
    </div>
  </div>
</ng-template>

<ng-template #multiReq>
  {{
    getMulti().numRequired === 1
      ? 'One of'
      : getMulti().numRequired === getMulti().requirements.length
      ? 'All of'
      : getMulti().numFulfilled(courses) + '/' + getMulti().numRequired + ' of'
  }}
  <app-requirement
    *ngFor="let childReq of getMulti().requirements"
    [requirement]="childReq"
    [courses]="courses"
  ></app-requirement>
</ng-template>

<ng-template #unitReq>
  {{ getUnit().unitsFulfilled(courses) }}/{{ getUnit().units }} units of
  <br />
  {{ getUnit().requirement.toString() }}
  <div ngbDropdown class="req-more">
    <button ngbDropdownToggle></button>
    <div ngbDropdownMenu>
      <button ngbDropdownItem (click)="openRequirementDisplay(getUnit().requirement)">Show Fulfilling Courses</button>
    </div>
  </div>
  <div class="nested">
    <div class="course" *ngFor="let course of getUnit().getFulfillingCourses(courses)">
      {{ course.getName() }}
    </div>
  </div>
</ng-template>

<ng-template #mutexReq>
  Distinctly fulfill
  <app-requirement
    *ngFor="let childStatus of getMutex().getFulfillment(courses)"
    [requirement]="childStatus.requirement"
    [courses]="[]"
    [override]="getMutexFulfillment(childStatus)"
  ></app-requirement>
</ng-template>

<div
  class="requirement"
  [ngClass]="getFulfillment()"
  [ngbPopover]="requirement.getAnnotation() ? annotation : null"
  [triggers]="requirement.getAnnotation() ? 'mouseenter:mouseleave' : null"
>
  <ng-container *ngTemplateOutlet="getReqTemplate()"></ng-container>
</div>

<!-- FIXME This can also be an XSS vector -->
<ng-template #annotation>
  <div [outerHTML]="getAnnotation()"></div>
</ng-template>

<ng-template #requirementDisplayTemplate>
  <app-requirement-display [requirementInput]="displayedRequirement"></app-requirement-display>
</ng-template>
